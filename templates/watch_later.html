{% extends 'base.html' %}

{% block title %}ë‚˜ì¤‘ì— ë³¼ ì˜ìƒ - MalgeunTube{% endblock %}

{% block content %}
<div class="page-container">
    <div class="page-header">
        <h2>ğŸ”– ë‚˜ì¤‘ì— ë³¼ ì˜ìƒ</h2>
        <p>{{ videos|length }}ê°œì˜ ì˜ìƒ</p>
    </div>

    {% if videos %}
    <div class="video-grid">
        {% for video in videos %}
        <div class="video-card-wrapper">
            <a href="{{ url_for('watch', v=video.id) }}" class="video-card">
                <div class="thumbnail">
                    <img src="{{ video.thumbnail }}" alt="{{ video.title }}" loading="lazy">
                    {% if video.duration %}
                    <span class="duration">{{ video.duration|duration }}</span>
                    {% endif %}
                </div>
                <div class="video-info">
                    <h4>{{ video.title }}</h4>
                    <p>{{ video.channel }}</p>
                    {% if video.added_at %}
                    <p class="added-time">{{ video.added_at|timeago }}</p>
                    {% endif %}
                </div>
            </a>
            <button class="remove-btn" onclick="removeFromWatchLater('{{ video.id }}', event)" title="ì œê±°">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
            </button>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">ğŸ”–</div>
        <h3>ë‚˜ì¤‘ì— ë³¼ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤</h3>
        <p>ì˜ìƒ ì¬ìƒ í˜ì´ì§€ë‚˜ ê²€ìƒ‰ ê²°ê³¼ì—ì„œ "ë‚˜ì¤‘ì— ë³´ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</p>
        <a href="{{ url_for('index') }}" class="btn">í™ˆìœ¼ë¡œ</a>
    </div>
    {% endif %}
</div>

<style>
.page-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 1rem;
}

.page-header {
    margin-bottom: 2rem;
}

.page-header h2 {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
}

.page-header p {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.video-card-wrapper {
    position: relative;
}

.remove-btn {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    background-color: rgba(0, 0, 0, 0.8);
    border: none;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: white;
    opacity: 0;
    transition: opacity 0.2s, background-color 0.2s;
    z-index: 1;
}

.video-card-wrapper:hover .remove-btn {
    opacity: 1;
}

.remove-btn:hover {
    background-color: var(--accent);
}

.added-time {
    font-size: 0.85rem;
    color: var(--text-secondary);
}

.empty-state {
    text-align: center;
    padding: 4rem 1rem;
}

.empty-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
}

.empty-state h3 {
    margin-bottom: 0.5rem;
}

.empty-state p {
    color: var(--text-secondary);
    margin-bottom: 2rem;
}
</style>

<script>
async function removeFromWatchLater(videoId, event) {
    event.preventDefault();
    event.stopPropagation();

    try {
        const response = await fetch('/api/watch-later/remove', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ video_id: videoId })
        });

        const data = await response.json();
        if (data.success) {
            showToast('ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤');
            location.reload();
        }
    } catch (error) {
        console.error('Error:', error);
        showToast('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
    }
}
</script>
{% endblock %}

